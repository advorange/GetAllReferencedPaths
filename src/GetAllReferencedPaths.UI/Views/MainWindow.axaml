<Window xmlns="https://github.com/avaloniaui"
				xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
				xmlns:vm="using:GetAllReferencedPaths.UI.ViewModels"
				xmlns:conv="using:GetAllReferencedPaths.UI.Converters"
				xmlns:sys="clr-namespace:System;assembly=mscorlib"
				xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
				xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
				mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
				x:Class="GetAllReferencedPaths.UI.Views.MainWindow"
				Name="Me"
				Icon="/Assets/avalonia-logo.ico"
				Title="GetAllReferencedPaths.UI">

	<Window.Resources>
		<ResourceDictionary>
			<sys:Int32 x:Key="InputSmallSpacer">5</sys:Int32>
			<Thickness x:Key="InputBigSpacer">0,0,0,10</Thickness>
			<Thickness x:Key="BasePadding">10</Thickness>
		</ResourceDictionary>
	</Window.Resources>

	<Window.Styles>
		<Style Selector="#Base > :is(Decorator)">
			<Setter Property="Padding" Value="{DynamicResource BasePadding}" />
		</Style>

		<Style Selector=":is(Layoutable).input-option">
			<Setter Property="Margin" Value="{DynamicResource InputBigSpacer}" />
		</Style>

		<Style Selector="ItemsRepeater.rel-paths">
			<Setter Property="ItemTemplate">
				<DataTemplate>
					<ContentControl Classes="rel-path" Content="{Binding}" />
				</DataTemplate>
			</Setter>
			<Setter Property="Layout">
				<StackLayout Spacing="{DynamicResource InputSmallSpacer}" />
			</Setter>
		</Style>

		<Style Selector="ContentControl.rel-path">
			<Setter Property="ContentTemplate">
				<DataTemplate>
					<Expander Name="rExpander" Padding="0" MinHeight="0"
										HorizontalAlignment="Stretch">
						<Expander.IsExpanded>
							<MultiBinding Converter="{x:Static BoolConverters.Or}">
								<Binding ElementName="rExpander" Path="IsExpanded" />
								<Binding ElementName="rTextBox" Path="IsFocused" />
							</MultiBinding>
						</Expander.IsExpanded>

						<Expander.Header>
							<TextBox Name="rTextBox" Text="{Binding Value}" />
						</Expander.Header>

						<Expander.Content>
							<ItemsRepeater Items="{Binding Paths}">
								<ItemsRepeater.ItemTemplate>
									<DataTemplate>
										<TextBlock Text="{Binding Path}"
															 Background="{Binding IsValid, Converter={x:Static conv:BrushConverters.FileExists}}" />
									</DataTemplate>
								</ItemsRepeater.ItemTemplate>
							</ItemsRepeater>
						</Expander.Content>
					</Expander>
				</DataTemplate>
			</Setter>
		</Style>
	</Window.Styles>

	<Grid Name="Base" ColumnDefinitions="*,*">
		<!-- Input -->
		<Border Grid.Column="0">
			<Grid RowDefinitions="*,auto,auto">
				<!-- Settings Only Modifiable Before Searching -->
				<ScrollViewer Grid.Row="0">
					<StackPanel IsEnabled="{Binding !FilesToProcess.Count}">
						<HeaderedContentControl Classes="input-option" Header="Base Directory">
							<TextBox Text="{Binding Args.BaseDirectory.Value}" TextWrapping="NoWrap" />
						</HeaderedContentControl>

						<StackPanel Classes="input-option">
							<HeaderedContentControl Header="Root Directories">
								<ItemsRepeater Classes="rel-paths" Items="{Binding Args.RootDirectories}" />
							</HeaderedContentControl>
							<Button Content="Add Root Directory" Command="{Binding AddRootDirectory}" />
						</StackPanel>

						<StackPanel Classes="input-option">
							<HeaderedContentControl Header="Source Files">
								<ItemsRepeater Classes="rel-paths" Items="{Binding Args.SourceFiles}" />
							</HeaderedContentControl>
							<Button Content="Add Source File" Command="{Binding AddSourceFile}" />
						</StackPanel>

						<HeaderedContentControl Classes="input-option" Header="Interchangeable File Types">
							<ItemsRepeater Items="{Binding Args.InterchangeableFileTypes}">
								<ItemsRepeater.Layout>
									<StackLayout Spacing="{DynamicResource InputSmallSpacer}" />
								</ItemsRepeater.Layout>

								<ItemsRepeater.ItemTemplate>
									<DataTemplate>
										<ItemsRepeater Items="{Binding}">
											<ItemsRepeater.Layout>
												<StackLayout Orientation="Horizontal" />
											</ItemsRepeater.Layout>
											<ItemsRepeater.ItemTemplate>
												<DataTemplate>
													<TextBox Text="{Binding Value}" />
												</DataTemplate>
											</ItemsRepeater.ItemTemplate>
										</ItemsRepeater>
									</DataTemplate>
								</ItemsRepeater.ItemTemplate>
							</ItemsRepeater>
						</HeaderedContentControl>
					</StackPanel>
				</ScrollViewer>

				<!-- Settings Modifiable At All Times -->
				<StackPanel Grid.Row="1">
					<HeaderedContentControl Header="Output Directory">
						<ContentControl Classes="rel-path" Content="{Binding Args.OutputDirectory}" />
					</HeaderedContentControl>
				</StackPanel>

				<!-- Button Ribbon -->
				<UniformGrid Grid.Row="2" Rows="1">
					<Button Content="Get Paths" Command="{Binding GetPaths}"
									IsVisible="{Binding !FilesToProcess.Count}" />
					<Button Content="Clear Paths" Command="{Binding ClearPaths}"
									IsVisible="{Binding FilesToProcess.Count}" />
				</UniformGrid>
			</Grid>
		</Border>

		<!-- Output -->
		<Border Grid.Column="1">
			<ScrollViewer>
				<ItemsRepeater Items="{Binding FilesToProcess}">
					<ItemsRepeater.ItemTemplate>
						<DataTemplate>
							<Border BorderThickness="1"
											BorderBrush="{DynamicResource TextControlBorderBrush}">
								<StackPanel>
									<HeaderedContentControl Header="Source">
										<TextBox Text="{Binding Source}" />
									</HeaderedContentControl>
									<HeaderedContentControl Header="Destination">
										<TextBox>
											<TextBox.Text>
												<MultiBinding Converter="{x:Static conv:PathConverters.Join}">
													<Binding ElementName="Me" Path="DataContext.Args.BaseDirectory.Value" />
													<Binding ElementName="Me" Path="DataContext.Args.OutputDirectory.Value" />
													<Binding Path="Time" />
													<Binding Path="Relative" />
												</MultiBinding>
											</TextBox.Text>
										</TextBox>
									</HeaderedContentControl>
								</StackPanel>
							</Border>
						</DataTemplate>
					</ItemsRepeater.ItemTemplate>

					<ItemsRepeater.Styles>
						<Style Selector="TextBox">
							<Setter Property="BorderThickness" Value="0" />
							<Setter Property="IsReadOnly" Value="True" />
							<Setter Property="TextWrapping" Value="Wrap" />
						</Style>
					</ItemsRepeater.Styles>
				</ItemsRepeater>
			</ScrollViewer>
		</Border>
	</Grid>
</Window>